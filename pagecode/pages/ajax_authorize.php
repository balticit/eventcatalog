<?php	class ajax_authorize_php extends CPageCodeHandler 	{		public function ajax_authorize_php()		{			$this->CPageCodeHandler();		}		public function PreRender()		{		}		public function Render()		{			header('Content-type: text/html;charset=windows-1251');			$user = new CSessionUser("user");			CAuthorizer::AuthentificateUserFromCookie(&$user);			CAuthorizer::RestoreUserFromSession(&$user);			$error = null;			$event = GP("event");			if (isset($event))			{				if ($event=="login") {					$login = iconv("utf-8","windows-1251",GP("login")); 					$password = GP("password");					if ($login!=NULL) { 					   $authresult = CAuthorizer::AuthentificateUser($login,$password,&$user);					   echo($authresult);					   if ($authresult == true && GP("remeber")=="remember") {						   setcookie('COOKIE_USER_AUTH',$login,time()+60*60*24*14,"/");						   						   						  // TIME IN SITE UPDATE                $user = new CSessionUser($user->type);              CAuthorizer::AuthentificateUserFromCookie(&$user);              CAuthorizer::RestoreUserFromSession(&$user);                            if ($user->type =="user")              {                $tbl =  "tbl__registered_user";              }              else { $tbl = "tbl__".$user->type."_doc"; }                            SQLProvider::ExecuteNonReturnQuery("update $tbl set last_visit_date=NOW() WHERE tbl_obj_id = $user->id AND last_visit_date<DATE_SUB(NOW(), INTERVAL 1 MINUTE) ");						  // END UPDATE EDIT DATE 						  						   					   }				   }						}							else				{					setcookie('COOKIE_USER_AUTH',"",0,"/");					$user->Clear();				}			}									        								}	}?>