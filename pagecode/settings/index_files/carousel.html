<script>
function str_replace ( search, replace, subject ) {	// Replace all occurrences of the search string with the replacement string
	// 
	// +   original by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
	// +   improved by: Gabriel Paderni

	if(!(replace instanceof Array)){
		replace=new Array(replace);
		if(search instanceof Array){//If search	is an array and replace	is a string, then this replacement string is used for every value of search
			while(search.length>replace.length){
				replace[replace.length]=replace[0];
			}
		}
	}

	if(!(search instanceof Array))search=new Array(search);
	while(search.length>replace.length){//If replace	has fewer values than search , then an empty string is used for the rest of replacement values
		replace[replace.length]='';
	}

	if(subject instanceof Array){//If subject is an array, then the search and replace is performed with every entry of subject , and the return value is an array as well.
		for(k in subject){
			subject[k]=str_replace(search,replace,subject[k]);
		}
		return subject;
	}

	for(var k=0; k<search.length; k++){
		var i = subject.indexOf(search[k]);
		while(i>-1){
			subject = subject.replace(search[k], replace[k]);
			i = subject.indexOf(search[k],i);
		}
	}

	return subject;

}    
    
var engine = {
    posts: [],
    img_dir:'/application/public/upload/',
    setMainArticle: function(id)
    {
        var post = this.getPostById(id);
        $("#main_article").html('<a id="carousel_main_link" href="'+post.link+'"><img width="450px" id="carousel_main_img" src="'+this.img_dir+post.image+'" ></a><div id="carousel_main_text"><h2>'+post.name+'</h2><p>'+post.description+'</p></div></div>');
    },
    setArticleList:function(id)
    {
        for(p in this.posts)
        {
            if (this.posts[p].id==id)
            {
                $("#post_list").append("<li class='carousel' id='post_"+this.posts[p].id+"' ><gg></gg><a style='color:#FA2800; text-decoration:underline' href='"+this.posts[p].link+"'>"+this.posts[p].name+"</a><div class='post_desc'>"+this.posts[p].description+"</div></li>");
            }
            else
            {
                $("#post_list").append("<li class='carousel' id='post_"+this.posts[p].id+"' ><gg></gg><a style='color:#282828' href='"+this.posts[p].link+"'>"+this.posts[p].name+"</a><div class='post_desc'>"+this.posts[p].description+"</div></li>");
            }
        }
        //$(".carousel .border:not(:last)").css({'border-top': "1px dashed gray",'opacity':"0.5",'height': "18px",'margin-right':"10px",'margin-top':"4px"});
    },
    setEvents:function()
    {
        var that = this;
        $(".carousel").mouseenter(
            function(){
                
                $(".carousel gg").hide();
                $("gg").html("");
                $(".carousel a").css("color","#282828");
                $(".carousel a").css("text-decoration","none");
            
                $(".carousel a").css("color","black");
                $(".carousel a").css("text-decoration","none");   
                $(".carousel gg").hide(); 
                
                $("gg",this).html("<");
                $(".carousel gg").show();
                $("gg",this).css("color","red");
                $("gg",this).css("font-weight","bold");
                
                $("a",this).css("color","red");
                $("a",this).css("text-decoration","underline");
                //$(".post_desc",this).show();
                var id = str_replace("post_", "", this.id);
                var post = that.getPostById(id);
                $("#carousel_main_link").attr("href",post.link);
                $("#carousel_main_img").attr("src",that.img_dir+post.image);
                $("#carousel_main_text p").html(post.description);
                $("#carousel_main_text h2").html(post.name);
            }
            
        );
    },
    //crutch
    getPostById:function(id)
    {
        for(p in this.posts)
        {
            if (this.posts[p].id==id)
            {
                return this.posts[p];
            }
        }
        return false;
    },
    init:function(posts)
    {
        this.posts = posts.slice(0);
        var id = posts[0].id;
        this.setMainArticle(id);
        this.setArticleList(id);
        this.setEvents();
    }
};




$(document).ready(function() {
    var articles = $.parseJSON('{articles}');
    engine.init(articles);
});

</script>
<div id="main_article">
</div>

<ul id="post_list" >
  
</ul>
